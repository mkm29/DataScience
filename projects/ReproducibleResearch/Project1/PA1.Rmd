---
title: 'Reproducible Research: Peer Assignment 1'
author: "Mitch Murphy"
date: "3/8/2018"
output: 
  html_document:
    keep_md: true
---

## Loading and preprocessing the data
```{r LoadData}
library(knitr)
setwd("~/Desktop/DataScience/coursera/projects/ReproducibleResearch/Project1/")

if(!file.exists("activity.csv")) {
  # need to download the zip file and then unzip it
  download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip", destfile = "activity.zip")
  unzip("activity.zip")
  file.remove("activity.zip")
}
activityData <- read.csv("activity.csv")
# need to convert the date column into an R date, so we can extract the day of week from it.
activityData$date <- with(activityData, as.POSIXct(date))
activityData$day <- with(activityData, weekdays(date))
activityData$timestamp <- with(activityData, date+interval)
```


## What is mean total number of steps taken per day?

Did the question imply day of the week (Mon. - Fri.) or just daily? Here is both. 
```{r}
library(dplyr)
library(ggplot2)
statsByWeekday <- activityData %>% group_by(day) %>% summarise(TotalSteps = sum(steps, na.rm = T), 
                                                               MeanSteps = mean(steps, na.rm = T), 
                                                               MedianSteps = median(steps, na.rm = T))

print(statsByWeekday)
ggplot(statsByWeekday, aes(day, TotalSteps, fill = day)) + geom_bar(stat = "identity", show.legend = F) +
  facet_grid(.~day) + xlab("Day") + ylab("Steps") + theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

daily <- activityData %>% group_by(date) %>%  summarise(TotalSteps = sum(steps, na.rm = T), 
                                                               MeanSteps = mean(steps, na.rm = T), 
                                                               MedianSteps = median(steps, na.rm = T))

ggplot(daily, aes(x = TotalSteps)) +
    geom_histogram(fill = "blue", binwidth = 500) +
    labs(x = "Steps", y = "Frequency")


print("Daily")
print(head(daily))


```

## What is the average daily activity pattern?
```{r}
library(ggplot2)
intervals <- activityData %>% group_by(interval) %>% summarise(Max = max(steps, na.rm = T))
plot(intervals, xlab = "Interval", ylab = "Steps", main = "Average Steps Per Time Interval")
```

If you look at the plot with interval being an indication of the time of day (starting at 12:01 AM), 
this data seems reasonable: your activity level ramps up after you wake up, until it peaks around mid-afternoon, 
and finally decreases before sleep. 

We can find the 5-minute interval that, on average, contains the maximum number of steps:
```{r}
which.max(intervals$Max)
```


## Imputing missing values

```{r}
length(which(is.na(activityData$steps)))
```

So there are 2304 missing observations. 

```{r impute}
library(Hmisc)
activityDataImputed <- activityData
activityDataImputed$steps <- impute(activityData$steps)
dailyImputed <- activityDataImputed %>% group_by(date) %>% summarise(steps = sum(steps, na.rm = T))
ggplot(dailyImputed, aes(x = steps)) +
  geom_histogram(fill = "blue", binwidth = 500) +
  labs(x = "Steps", y = "Frequency")
```


## Are there differences in activity patterns between weekdays and weekends?
```{r}
daily$Weekend <- as.factor(ifelse(weekdays(daily$date) %in% c("Saturday", "Sunday"), TRUE, FALSE))
ggplot(daily, aes(date, TotalSteps, color=Weekend)) + geom_line()+facet_wrap(~Weekend)+labs(title = "Total Steps: Weekend vs. Weekday", x = "Interval", y = "No. of Steps")
```

As would be expected, this particular person was not nearly as active during the weekends than during the week.